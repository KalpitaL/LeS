var sessLastActivity, idleTimer, remainingTimer, sess_intervalID, idleIntervalID, sess_lastActivity, timer, sessServerAliveTime = 1200, sessionTimeout = 6e4, isTimout = !1, valCounter = null, ckTimeoutVal = 0, isIdleTimerOn = !1; function initSessionMonitor() { $(document).bind("keypress.session", function (e, s) { sessKeyPressed(e, s) }), $(document).bind("mousedown keydown", function (e, s) { sessKeyPressed(e, s) }), sessServerAlive(), startIdleTime() } function sessPingServer() { if (!isTimout) return !0 } function sessServerAlive() { sess_intervalID = setInterval("sessPingServer()", sessServerAliveTime) } function sessKeyPressed(e, s) { var o = e ? e.target : window.event.srcElement, n = $(o).parents("#session-expire-warning-modal").length; null != n && null != n && null != e.currentTarget.activeElement && "btnSessionExpiredCancelled" != e.target.id && "btnSessionModal" != e.target.id && "session-expire-warning-modal" != e.currentTarget.activeElement.id && "btnExpiredOk" != e.target.id && "modal fade modal-overflow in" != e.currentTarget.activeElement.className && "modal-header" != e.currentTarget.activeElement.className && 1 != n && "session-expire-warning-modal" != e.target.id && (localStorage.setItem("sessionSlide", "isStarted"), startIdleTime()) } function startIdleTime() { stopIdleTime(), localStorage.setItem("sessIdleTimeCounter", $.now()), idleIntervalID = setInterval("checkIdleTimeout()", 1e3), isIdleTimerOn = !1 } localStorage.setItem("sessionSlide", "isStarted"), $(window).scroll(function (e) { localStorage.setItem("sessionSlide", "isStarted"), startIdleTime() }); var sessionExpired = document.getElementById("session-expired-modal"); function sessionExpiredClicked(e) { window.location = "../Common/Logout.aspx" } function LoginSession() { valCounter == $("#txtValidateCounter").val() ? location.reload(!0) : alert("Code mismatch") } function LogoutSession() { window.location = "../Common/Logout.aspx?LOGOUT" } function stopIdleTime() { clearInterval(idleIntervalID), clearInterval(remainingTimer) } function checkIdleTimeout() { var e = parseInt(localStorage.getItem("sessIdleTimeCounter")) + sessionTimeout; if ($.now() > e + 12e4) ckTimeoutVal <= 1 ? ($("#session-expire-warning-modal").modal("hide"), $("#session-expired-modal").modal("show"), clearInterval(sess_intervalID), clearInterval(idleIntervalID), $(".modal-backdrop").css("z-index", parseInt($(".modal-backdrop").css("z-index")) + 100), $("#session-expired-modal").css("z-index", 2e3), $("#btnExpiredOk").css("background-color", "#428bca"), $("#btnExpiredOk").css("color", "#fff"), isTimout = !0, window.location = "../Common/Logout.aspx") : (sessionTimeout = 6e4 * ckTimeoutVal, $("#session-expire-warning-modal").modal("hide"), $("#session-expired-modal").modal("hide"), startIdleTime()); else if ($.now() > e) { if (!isIdleTimerOn) if (CheckSessionValue(), ckTimeoutVal <= 1) localStorage.setItem("sessionSlide", !1), countdownDisplay(), $(".modal-backdrop").css("z-index", parseInt($(".modal-backdrop").css("z-index")) + 500), $("#session-expire-warning-modal").css("z-index", 1500), $("#btnOk").css("background-color", "#428bca"), $("#btnOk").css("color", "#fff"), $("#btnSessionExpiredCancelled").css("background-color", "#428bca"), $("#btnSessionExpiredCancelled").css("color", "#fff"), $("#btnLogoutNow").css("background-color", "#428bca"), $("#btnLogoutNow").css("color", "#fff"), $("#seconds-timer").empty(), $("#session-expire-warning-modal").modal("show"), valCounter = Math.floor(1e5 + 9e5 * Math.random()), span = document.getElementById("uCounter"), span.innerHTML = valCounter, $("#txtValidateCounter").val(""), isIdleTimerOn = !0; else sessionTimeout = 6e4 * ckTimeoutVal, startIdleTime() } } function countdownDisplay() { var e = 120; remainingTimer = setInterval(function () { "isStarted" == localStorage.getItem("sessionSlide") ? ($("#session-expire-warning-modal").modal("hide"), startIdleTime(), clearInterval(remainingTimer)) : "loggedOut" == localStorage.getItem("sessionSlide") ? ($("#session-expire-warning-modal").modal("hide"), $("#session-expired-modal").modal("show")) : ($("#seconds-timer").html(e), e -= 1) }, 1e3) } function CheckSessionValue() { try { jQuery.ajax({ type: "POST", dataType: "json", traditional: !0, async: !1, url: "../Common/Default.aspx/GetSessionData", contentType: "application/json; charset=uts-8", success: function (e) { ckTimeoutVal = e.d }, error: function (e) { alert(e.responseText) } }) } catch (e) { aler(e.message) } } function sessLogOut() { } $("#btnSessionExpiredCancelled").click(function () { $(".modal-backdrop").css("z-index", parseInt($(".modal-backdrop").css("z-index")) - 500) }), $("#btnOk").click(function () { $("#session-expire-warning-modal").modal("hide"), $(".modal-backdrop").css("z-index", parseInt($(".modal-backdrop").css("z-index")) - 500), startIdleTime(), clearInterval(remainingTimer), localStorage.setItem("sessionSlide", "isStarted") }), $("#btnLogoutNow").click(function () { localStorage.setItem("sessionSlide", "loggedOut"), window.location = "../Common/Logout.aspx?Logout", $("#session-expired-modal").modal("hide") }), $("#session-expired-modal").on("shown.bs.modal", function () { $("#session-expire-warning-modal").modal("hide"), $(this).before($(".modal-backdrop")), $(this).css("z-index", parseInt($(".modal-backdrop").css("z-index")) + 1) }), $("#session-expired-modal").on("hidden.bs.modal", function () { window.location = "../Common/Logout.aspx" }), $("#session-expire-warning-modal").on("shown.bs.modal", function () { $("#session-expire-warning-modal").modal("show"), $(this).before($(".modal-backdrop")), $(this).css("z-index", parseInt($(".modal-backdrop").css("z-index")) + 1) });